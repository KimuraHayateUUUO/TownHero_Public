<!-- Developper : shimizu hirofumi
     outline : 現在地を取得し、地図に表示する。地図のタイルは３種類が使用可能
     date : 2019/6/16 -->
<!DOCTYPE html>
<html>

  <head>
    <meta charset="UTF-8">
    <title>towmhero_prototype</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="">
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>-
    <link rel="stylesheet" href="stylesheet.css">
    <link href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" rel="stylesheet">
    <link rel="stylesheet" href="../plugin/L.Icon.Pulse.css" >
    <script src="../plugin/L.Icon.Pulse.js" ></script>

    <script>
      function init() {
        navigator.geolocation.getCurrentPosition(function succes_func(position) {
          //取得したデータを整理
          var data = position.coords;
          //lat:緯度　lng:経度
          var lat = data.latitude;
          var lng = data.longitude;
          var map = L.map('mapcontainer', {zoomControl: false});
          var mpoint = [lat, lng]
          map.setView(mpoint, 20);
          var pulsingIcon = L.icon.pulse({iconSize:[20,20],color:'red'});
          L.marker([lat, lng],{icon: pulsingIcon}).addTo(map);
          L.control.scale({maxWidth: 200, position: 'bottomright', imperial: false}).addTo(map);
          L.control.zoom({position: 'bottomleft'}).addTo(map);
          //地理院地図の標準地図タイル
          var gsi = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {attribution: "<a href='https://maps.gsi.go.jp/development/ichiran.html' target='_blank'>地理院タイル</a>"});
          //地理院地図の淡色地図タイル
          var gsipale = L.tileLayer('http://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png', {attribution: "<a href='http://portal.cyberjapan.jp/help/termsofuse.html' target='_blank'>地理院タイル</a>"});
          //オープンストリートマップのタイル
          var osm = L.tileLayer('http://tile.openstreetmap.jp/{z}/{x}/{y}.png', {attribution: "<a href='http://osm.org/copyright' target='_blank'>OpenStreetMap</a> contributors"});
          //baseMapsオブジェクトのプロパティに3つのタイルを設定
          var baseMaps = {
            "地理院地図": gsi,
            "淡色地図": gsipale,
            "オープンストリートマップ": osm
          };
          //layersコントロールにbaseMapsオブジェクトを設定して地図に追加 コントロール内にプロパティ名が表示される。
          L.control.layers(baseMaps).addTo(map);
          gsi.addTo(map);

          //地図のclickイベントでonMapClick関数を呼び出し
          map.on('click', onMapClick);

          function onMapClick(e) {
            //地図のclickイベント呼び出される クリック地点の座標にマーカーを追加、マーカーのclickイベントでonMarkerClick関数を呼び出し
            var mk = L.marker(e.latlng).on('click', onMarkerClick).addTo(map);
          }

          function onMarkerClick(e) {
            //マーカーのclickイベント呼び出される クリックされたマーカーを地図のレイヤから削除する。
            map.removeLayer(e.target);
          }
        }, function (error) {
          switch (error.code) {
            case 1: //PERMISSION_DENIED
              alert("位置情報の利用が許可されていません");
              break;
            case 2: //POSITION_UNAVAILABLE
              alert("現在位置が取得できませんでした。");
              break;
            case 3: //TIMEOUT
              alert("タイムアウトになりました。");
              break;
            default:
              alert("その他のエラー(エラーコード:" + error.code + ")");
              break;
          }
        });

      }
    </script>
  </head>

  <body onload="init()">
    <header>
      <div>
        <i class="fas fa-search-location"></i>
        <i class="fas fa-cogs"></i>
        <i class="fas fa-question-circle"></i>
      </div>
    </header>
    <footer>
      <div class="">
        <i class="fas fa-thumbtack"></i><!--
        --><i class="fas fa-walking"></i><!--
        --><i class="fas fa-map-marked-alt"></i><!--
        --><i class="fas fa-folder-plus"></i>
      </div>
    </footer>
    <div id="mapcontainer" style="position:absolute;top:0;left:0;right:0;bottom:0;"></div>
  </body>

</html>
